import { __decorate, __metadata } from "tslib";
import { Injectable, NgZone } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
export function win() {
    return window;
}
export function YouTubeRef() {
    return win()['YT'];
}
export function YouTubePlayerRef() {
    return YouTubeRef().Player;
}
export const defaultSizes = {
    height: 270,
    width: 367
};
let YoutubePlayerService = class YoutubePlayerService {
    constructor(zone) {
        this.zone = zone;
        this.ytApiLoaded = false;
        this.api = new ReplaySubject(1);
        this.createApi();
    }
    loadPlayerApi(options) {
        const doc = win().document;
        if (!this.ytApiLoaded) {
            this.ytApiLoaded = true;
            const playerApiScript = doc.createElement('script');
            playerApiScript.type = 'text/javascript';
            playerApiScript.src = `${options.protocol}://www.youtube.com/iframe_api`;
            doc.body.appendChild(playerApiScript);
        }
    }
    setupPlayer(elementId, outputs, sizes, videoId = '', playerVars) {
        const createPlayer = () => {
            if (YouTubePlayerRef) {
                this.createPlayer(elementId, outputs, sizes, videoId, playerVars);
            }
        };
        this.api.subscribe(createPlayer);
    }
    play(player) {
        player.playVideo();
    }
    pause(player) {
        player.pauseVideo();
    }
    playVideo(media, player) {
        const id = media.id.videoId ? media.id.videoId : media.id;
        player.loadVideoById(id);
        this.play(player);
    }
    isPlaying(player) {
        // because YT is not loaded yet 1 is used - YT.PlayerState.PLAYING
        const isPlayerReady = player && player.getPlayerState;
        const playerState = isPlayerReady ? player.getPlayerState() : {};
        const isPlayerPlaying = isPlayerReady
            ? playerState !== YouTubeRef().PlayerState.ENDED &&
                playerState !== YouTubeRef().PlayerState.PAUSED
            : false;
        return isPlayerPlaying;
    }
    createPlayer(elementId, outputs, sizes, videoId = '', playerVars = {}) {
        const playerSize = {
            height: sizes.height || defaultSizes.height,
            width: sizes.width || defaultSizes.width
        };
        const ytPlayer = YouTubePlayerRef();
        return new ytPlayer(elementId, Object.assign(Object.assign({}, playerSize), { events: {
                onReady: (ev) => {
                    this.zone.run(() => outputs.ready && outputs.ready.next(ev.target));
                },
                onStateChange: (ev) => {
                    this.zone.run(() => outputs.change && outputs.change.next(ev));
                }
            }, playerVars,
            videoId }));
    }
    toggleFullScreen(player, isFullScreen) {
        let { height, width } = defaultSizes;
        if (!isFullScreen) {
            height = window.innerHeight;
            width = window.innerWidth;
        }
        player.setSize(width, height);
    }
    // adpoted from uid
    generateUniqueId() {
        const len = 7;
        return Math.random()
            .toString(35)
            .substr(2, len);
    }
    createApi() {
        const onYouTubeIframeAPIReady = () => {
            if (win()) {
                this.api.next(YouTubeRef());
            }
        };
        win()['onYouTubeIframeAPIReady'] = onYouTubeIframeAPIReady;
    }
};
YoutubePlayerService.ɵfac = function YoutubePlayerService_Factory(t) { return new (t || YoutubePlayerService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
YoutubePlayerService.ɵprov = i0.ɵɵdefineInjectable({ factory: function YoutubePlayerService_Factory() { return new YoutubePlayerService(i0.ɵɵinject(i0.NgZone)); }, token: YoutubePlayerService, providedIn: "root" });
YoutubePlayerService = __decorate([ __metadata("design:paramtypes", [NgZone])
], YoutubePlayerService);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(YoutubePlayerService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();
export { YoutubePlayerService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC15b3V0dWJlLXBsYXllci9zcmMvbGliL25neC15b3V0dWJlLXBsYXllci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3JDOztBQUVBLE1BQU0sVUFBVSxHQUFHO0FBQ25CLElBQUUsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQUVELE1BQU0sVUFBVSxVQUFVO0FBQzFCLElBQUUsT0FBTyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNyQixDQUFDO0FBRUQsTUFBTSxVQUFVLGdCQUFnQjtBQUNoQyxJQUFFLE9BQU8sVUFBVSxFQUFFLENBQUMsTUFBTSxDQUFDO0FBQzdCLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUc7QUFDNUIsSUFBRSxNQUFNLEVBQUUsR0FBRztBQUNiLElBQUUsS0FBSyxFQUFFLEdBQUc7QUFDWixDQUFDLENBQUM7QUFLRixJQUFhLG9CQUFvQixHQUFqQyxNQUFhLG9CQUFvQjtBQUNqQyxJQUtFLFlBQW9CLElBQVk7QUFDbEMsUUFEc0IsU0FBSSxHQUFKLElBQUksQ0FBUTtBQUFDLFFBRnpCLGdCQUFXLEdBQUcsS0FBSyxDQUFDO0FBQzlCLFFBRUksSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNwQyxRQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUNyQixJQUFFLENBQUM7QUFDSCxJQUNFLGFBQWEsQ0FBQyxPQUFnQztBQUNoRCxRQUFJLE1BQU0sR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQztBQUMvQixRQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO0FBQzNCLFlBQU0sSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7QUFDOUIsWUFBTSxNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFELFlBQU0sZUFBZSxDQUFDLElBQUksR0FBRyxpQkFBaUIsQ0FBQztBQUMvQyxZQUFNLGVBQWUsQ0FBQyxHQUFHLEdBQUcsR0FBRyxPQUFPLENBQUMsUUFBUSwrQkFBK0IsQ0FBQztBQUMvRSxZQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzVDLFNBQUs7QUFDTCxJQUFFLENBQUM7QUFDSCxJQUNFLFdBQVcsQ0FDVCxTQUFpQixFQUNqQixPQUF1QixFQUN2QixLQUFrQixFQUNsQixPQUFPLEdBQUcsRUFBRSxFQUNaLFVBQXlCO0FBQzFCLFFBQ0MsTUFBTSxZQUFZLEdBQUcsR0FBRyxFQUFFO0FBQzlCLFlBQU0sSUFBSSxnQkFBZ0IsRUFBRTtBQUM1QixnQkFBUSxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztBQUMxRSxhQUFPO0FBQ1AsUUFBSSxDQUFDLENBQUM7QUFDTixRQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3JDLElBQUUsQ0FBQztBQUNILElBQ0UsSUFBSSxDQUFDLE1BQWlCO0FBQ3hCLFFBQUksTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO0FBQ3ZCLElBQUUsQ0FBQztBQUNILElBQ0UsS0FBSyxDQUFDLE1BQWlCO0FBQ3pCLFFBQUksTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBQ3hCLElBQUUsQ0FBQztBQUNILElBQ0UsU0FBUyxDQUFDLEtBQVUsRUFBRSxNQUFpQjtBQUN6QyxRQUFJLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztBQUM5RCxRQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDN0IsUUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3RCLElBQUUsQ0FBQztBQUNILElBQ0UsU0FBUyxDQUFDLE1BQWlCO0FBQzdCLFFBQUksa0VBQWtFO0FBQ3RFLFFBQUksTUFBTSxhQUFhLEdBQVEsTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUM7QUFDL0QsUUFBSSxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQ3JFLFFBQUksTUFBTSxlQUFlLEdBQUcsYUFBYTtBQUN6QyxZQUFNLENBQUMsQ0FBQyxXQUFXLEtBQUssVUFBVSxFQUFFLENBQUMsV0FBVyxDQUFDLEtBQUs7QUFDdEQsZ0JBQVEsV0FBVyxLQUFLLFVBQVUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNO0FBQ3ZELFlBQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQztBQUNkLFFBQUksT0FBTyxlQUFlLENBQUM7QUFDM0IsSUFBRSxDQUFDO0FBQ0gsSUFDRSxZQUFZLENBQ1YsU0FBaUIsRUFDakIsT0FBdUIsRUFDdkIsS0FBa0IsRUFDbEIsT0FBTyxHQUFHLEVBQUUsRUFDWixhQUE0QixFQUFFO0FBQy9CLFFBQ0MsTUFBTSxVQUFVLEdBQUc7QUFDdkIsWUFBTSxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU0sSUFBSSxZQUFZLENBQUMsTUFBTTtBQUNqRCxZQUFNLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLFlBQVksQ0FBQyxLQUFLO0FBQzlDLFNBQUssQ0FBQztBQUNOLFFBQUksTUFBTSxRQUFRLEdBQUcsZ0JBQWdCLEVBQUUsQ0FBQztBQUN4QyxRQUFJLE9BQU8sSUFBSSxRQUFRLENBQUMsU0FBUyxrQ0FDeEIsVUFBVSxLQUNiLE1BQU0sRUFBRTtBQUNkLGdCQUFRLE9BQU8sRUFBRSxDQUFDLEVBQWtCLEVBQUUsRUFBRTtBQUN4QyxvQkFBVSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQzlFLGdCQUFRLENBQUM7QUFDVCxnQkFBUSxhQUFhLEVBQUUsQ0FBQyxFQUFrQixFQUFFLEVBQUU7QUFDOUMsb0JBQVUsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ3pFLGdCQUFRLENBQUM7QUFDVCxhQUFPLEVBQ0QsVUFBVTtBQUNoQixZQUFNLE9BQU8sSUFDUCxDQUFDO0FBQ1AsSUFBRSxDQUFDO0FBQ0gsSUFDRSxnQkFBZ0IsQ0FDZCxNQUFpQixFQUNqQixZQUF3QztBQUN6QyxRQUNDLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsWUFBWSxDQUFDO0FBQ3pDLFFBQ0ksSUFBSSxDQUFDLFlBQVksRUFBRTtBQUN2QixZQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO0FBQ2xDLFlBQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7QUFDaEMsU0FBSztBQUNMLFFBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDbEMsSUFBRSxDQUFDO0FBQ0gsSUFDRSxtQkFBbUI7QUFDckIsSUFBRSxnQkFBZ0I7QUFDbEIsUUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDbEIsUUFBSSxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUU7QUFDeEIsYUFBTyxRQUFRLENBQUMsRUFBRSxDQUFDO0FBQ25CLGFBQU8sTUFBTSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN0QixJQUFFLENBQUM7QUFDSCxJQUNVLFNBQVM7QUFDbkIsUUFBSSxNQUFNLHVCQUF1QixHQUFHLEdBQUcsRUFBRTtBQUN6QyxZQUFNLElBQUksR0FBRyxFQUFFLEVBQUU7QUFDakIsZ0JBQVEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztBQUNwQyxhQUFPO0FBQ1AsUUFBSSxDQUFDLENBQUM7QUFDTixRQUFJLEdBQUcsRUFBRSxDQUFDLHlCQUF5QixDQUFDLEdBQUcsdUJBQXVCLENBQUM7QUFDL0QsSUFBRSxDQUFDO0FBQ0gsQ0FBQztpSkFBQTtBQUNEO0FBdkhhLG9CQUFvQixvQkFIaEMsVUFBVSxDQUFDLFVBQ1YsVUFBVSxFQUFFLHRDQUVWLGtDQU13QixNQUFNO0NBUmQsTUFDbkIsQ0FBQyxSQU9tQyxHQU54QixvQkFBb0IsQ0FzSGhDOzs7Ozs7dUVBQ0Q7O0FBL0lBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFLQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFNQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBdEhBLEFBQUEsQUFIQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFPQSxBQUFBLEFBTkEsQUFBQSxBQXNIQSxBQXRIQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBJUGxheWVyQXBpU2NyaXB0T3B0aW9ucywgSVBsYXllck91dHB1dHMsIElQbGF5ZXJTaXplIH0gZnJvbSAnLi9tb2RlbHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gd2luKCkge1xuICByZXR1cm4gd2luZG93O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gWW91VHViZVJlZigpIHtcbiAgcmV0dXJuIHdpbigpWydZVCddO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gWW91VHViZVBsYXllclJlZigpIHtcbiAgcmV0dXJuIFlvdVR1YmVSZWYoKS5QbGF5ZXI7XG59XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0U2l6ZXMgPSB7XG4gIGhlaWdodDogMjcwLFxuICB3aWR0aDogMzY3XG59O1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBZb3V0dWJlUGxheWVyU2VydmljZSB7XG4gIC8vIGFwaTogUmVwbGF5U3ViamVjdDxZVC5QbGF5ZXI+O1xuICBhcGk6IFJlcGxheVN1YmplY3Q8YW55PjtcblxuICBwcml2YXRlIHl0QXBpTG9hZGVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB6b25lOiBOZ1pvbmUpIHtcbiAgICB0aGlzLmFwaSA9IG5ldyBSZXBsYXlTdWJqZWN0KDEpO1xuICAgIHRoaXMuY3JlYXRlQXBpKCk7XG4gIH1cblxuICBsb2FkUGxheWVyQXBpKG9wdGlvbnM6IElQbGF5ZXJBcGlTY3JpcHRPcHRpb25zKSB7XG4gICAgY29uc3QgZG9jID0gd2luKCkuZG9jdW1lbnQ7XG4gICAgaWYgKCF0aGlzLnl0QXBpTG9hZGVkKSB7XG4gICAgICB0aGlzLnl0QXBpTG9hZGVkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IHBsYXllckFwaVNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHBsYXllckFwaVNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICBwbGF5ZXJBcGlTY3JpcHQuc3JjID0gYCR7b3B0aW9ucy5wcm90b2NvbH06Ly93d3cueW91dHViZS5jb20vaWZyYW1lX2FwaWA7XG4gICAgICBkb2MuYm9keS5hcHBlbmRDaGlsZChwbGF5ZXJBcGlTY3JpcHQpO1xuICAgIH1cbiAgfVxuXG4gIHNldHVwUGxheWVyKFxuICAgIGVsZW1lbnRJZDogc3RyaW5nLFxuICAgIG91dHB1dHM6IElQbGF5ZXJPdXRwdXRzLFxuICAgIHNpemVzOiBJUGxheWVyU2l6ZSxcbiAgICB2aWRlb0lkID0gJycsXG4gICAgcGxheWVyVmFyczogWVQuUGxheWVyVmFyc1xuICApIHtcbiAgICBjb25zdCBjcmVhdGVQbGF5ZXIgPSAoKSA9PiB7XG4gICAgICBpZiAoWW91VHViZVBsYXllclJlZikge1xuICAgICAgICB0aGlzLmNyZWF0ZVBsYXllcihlbGVtZW50SWQsIG91dHB1dHMsIHNpemVzLCB2aWRlb0lkLCBwbGF5ZXJWYXJzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuYXBpLnN1YnNjcmliZShjcmVhdGVQbGF5ZXIpO1xuICB9XG5cbiAgcGxheShwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIHBsYXllci5wbGF5VmlkZW8oKTtcbiAgfVxuXG4gIHBhdXNlKHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgcGxheWVyLnBhdXNlVmlkZW8oKTtcbiAgfVxuXG4gIHBsYXlWaWRlbyhtZWRpYTogYW55LCBwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIGNvbnN0IGlkID0gbWVkaWEuaWQudmlkZW9JZCA/IG1lZGlhLmlkLnZpZGVvSWQgOiBtZWRpYS5pZDtcbiAgICBwbGF5ZXIubG9hZFZpZGVvQnlJZChpZCk7XG4gICAgdGhpcy5wbGF5KHBsYXllcik7XG4gIH1cblxuICBpc1BsYXlpbmcocGxheWVyOiBZVC5QbGF5ZXIpIHtcbiAgICAvLyBiZWNhdXNlIFlUIGlzIG5vdCBsb2FkZWQgeWV0IDEgaXMgdXNlZCAtIFlULlBsYXllclN0YXRlLlBMQVlJTkdcbiAgICBjb25zdCBpc1BsYXllclJlYWR5OiBhbnkgPSBwbGF5ZXIgJiYgcGxheWVyLmdldFBsYXllclN0YXRlO1xuICAgIGNvbnN0IHBsYXllclN0YXRlID0gaXNQbGF5ZXJSZWFkeSA/IHBsYXllci5nZXRQbGF5ZXJTdGF0ZSgpIDoge307XG4gICAgY29uc3QgaXNQbGF5ZXJQbGF5aW5nID0gaXNQbGF5ZXJSZWFkeVxuICAgICAgPyBwbGF5ZXJTdGF0ZSAhPT0gWW91VHViZVJlZigpLlBsYXllclN0YXRlLkVOREVEICYmXG4gICAgICAgIHBsYXllclN0YXRlICE9PSBZb3VUdWJlUmVmKCkuUGxheWVyU3RhdGUuUEFVU0VEXG4gICAgICA6IGZhbHNlO1xuICAgIHJldHVybiBpc1BsYXllclBsYXlpbmc7XG4gIH1cblxuICBjcmVhdGVQbGF5ZXIoXG4gICAgZWxlbWVudElkOiBzdHJpbmcsXG4gICAgb3V0cHV0czogSVBsYXllck91dHB1dHMsXG4gICAgc2l6ZXM6IElQbGF5ZXJTaXplLFxuICAgIHZpZGVvSWQgPSAnJyxcbiAgICBwbGF5ZXJWYXJzOiBZVC5QbGF5ZXJWYXJzID0ge31cbiAgKSB7XG4gICAgY29uc3QgcGxheWVyU2l6ZSA9IHtcbiAgICAgIGhlaWdodDogc2l6ZXMuaGVpZ2h0IHx8IGRlZmF1bHRTaXplcy5oZWlnaHQsXG4gICAgICB3aWR0aDogc2l6ZXMud2lkdGggfHwgZGVmYXVsdFNpemVzLndpZHRoXG4gICAgfTtcbiAgICBjb25zdCB5dFBsYXllciA9IFlvdVR1YmVQbGF5ZXJSZWYoKTtcbiAgICByZXR1cm4gbmV3IHl0UGxheWVyKGVsZW1lbnRJZCwge1xuICAgICAgLi4ucGxheWVyU2l6ZSxcbiAgICAgIGV2ZW50czoge1xuICAgICAgICBvblJlYWR5OiAoZXY6IFlULlBsYXllckV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiBvdXRwdXRzLnJlYWR5ICYmIG91dHB1dHMucmVhZHkubmV4dChldi50YXJnZXQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TdGF0ZUNoYW5nZTogKGV2OiBZVC5QbGF5ZXJFdmVudCkgPT4ge1xuICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4gb3V0cHV0cy5jaGFuZ2UgJiYgb3V0cHV0cy5jaGFuZ2UubmV4dChldikpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGxheWVyVmFycyxcbiAgICAgIHZpZGVvSWRcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZUZ1bGxTY3JlZW4oXG4gICAgcGxheWVyOiBZVC5QbGF5ZXIsXG4gICAgaXNGdWxsU2NyZWVuOiBib29sZWFuIHwgbnVsbCB8IHVuZGVmaW5lZFxuICApIHtcbiAgICBsZXQgeyBoZWlnaHQsIHdpZHRoIH0gPSBkZWZhdWx0U2l6ZXM7XG5cbiAgICBpZiAoIWlzRnVsbFNjcmVlbikge1xuICAgICAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICB9XG4gICAgcGxheWVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7XG4gIH1cblxuICAvLyBhZHBvdGVkIGZyb20gdWlkXG4gIGdlbmVyYXRlVW5pcXVlSWQoKSB7XG4gICAgY29uc3QgbGVuID0gNztcbiAgICByZXR1cm4gTWF0aC5yYW5kb20oKVxuICAgICAgLnRvU3RyaW5nKDM1KVxuICAgICAgLnN1YnN0cigyLCBsZW4pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcGkoKSB7XG4gICAgY29uc3Qgb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkgPSAoKSA9PiB7XG4gICAgICBpZiAod2luKCkpIHtcbiAgICAgICAgdGhpcy5hcGkubmV4dChZb3VUdWJlUmVmKCkpO1xuICAgICAgfVxuICAgIH07XG4gICAgd2luKClbJ29uWW91VHViZUlmcmFtZUFQSVJlYWR5J10gPSBvbllvdVR1YmVJZnJhbWVBUElSZWFkeTtcbiAgfVxufVxuIl19