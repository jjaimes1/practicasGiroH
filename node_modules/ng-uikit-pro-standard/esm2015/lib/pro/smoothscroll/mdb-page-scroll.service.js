/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, isDevMode } from '@angular/core';
import { PageScrollConfig } from './mdb-page-scroll.config';
import { PageScrollUtilService as Util } from './mdb-page-scroll-util.service';
import * as ɵngcc0 from '@angular/core';
export class PageScrollService {
    constructor() {
        this.runningInstances = [];
        this.onInterrupted = {
            report: (/**
             * @param {?} event
             * @param {?} pageScrollInstance
             * @return {?}
             */
            (event, pageScrollInstance) => {
                if (!pageScrollInstance.interruptible) {
                    // Non-interruptible anyway, so do not stop anything
                    return;
                }
                /** @type {?} */
                let shouldStop = true;
                if (event.type === 'keyup') {
                    // Only stop if specific keys have been pressed, for all others don't stop anything
                    // tslint:disable-next-line: deprecation
                    if (PageScrollConfig._interruptKeys.indexOf(((/** @type {?} */ (event))).keyCode) === -1) {
                        // The pressed key is not in the list of interrupting keys
                        shouldStop = false;
                    }
                }
                else if (event.type === 'mousedown') {
                    // For mousedown events we only stop the scroll animation of the mouse has
                    // been clicked inside the scrolling container
                    if (!pageScrollInstance.scrollingViews.some((/**
                     * @param {?} scrollingView
                     * @return {?}
                     */
                    scrollingView => scrollingView.contains(event.target)))) {
                        // Mouse clicked an element which is not inside any of the the scrolling containers
                        shouldStop = false;
                    }
                }
                if (shouldStop) {
                    this.stopAll(pageScrollInstance.namespace);
                }
            }),
        };
        if (PageScrollService.instanceCounter > 0 && isDevMode()) {
            console.warn('An instance of PageScrollService already exists, usually ' +
                'including one provider should be enough, so double check.');
        }
        PageScrollService.instanceCounter++;
    }
    /**
     * @private
     * @param {?} interrupted
     * @param {?} pageScrollInstance
     * @return {?}
     */
    stopInternal(interrupted, pageScrollInstance) {
        /** @type {?} */
        const index = this.runningInstances.indexOf(pageScrollInstance);
        if (index >= 0) {
            this.runningInstances.splice(index, 1);
        }
        if (pageScrollInstance.interruptListenersAttached) {
            pageScrollInstance.detachInterruptListeners();
        }
        if (pageScrollInstance.timer) {
            // Clear/Stop the timer
            clearInterval(pageScrollInstance.timer);
            // Clear the reference to this timer
            pageScrollInstance.timer = undefined;
            pageScrollInstance.fireEvent(!interrupted);
            return true;
        }
        return false;
    }
    /**
     * Start a scroll animation. All properties of the animation are stored in the given {\@link PageScrollInstance} object.
     *
     * This is the core functionality of the whole library.
     *
     * @param {?} pageScrollInstance
     * @return {?}
     */
    start(pageScrollInstance) {
        // Stop all possibly running scroll animations in the same namespace
        this.stopAll(pageScrollInstance.namespace);
        if (pageScrollInstance.scrollingViews === null ||
            pageScrollInstance.scrollingViews.length === 0) {
            // No scrollingViews specified, thus we can't animate anything
            if (isDevMode()) {
                console.warn('No scrollingViews specified, this ng2-page-scroll does not know which DOM elements to scroll');
            }
            return;
        }
        /** @type {?} */
        let startScrollPositionFound = false;
        // Reset start scroll position to 0. If any of the scrollingViews has a different one, it will be extracted next
        pageScrollInstance.startScrollPosition = 0;
        // Get the start scroll position from the scrollingViews (e.g. if the user already scrolled down the content)
        pageScrollInstance.scrollingViews.forEach((/**
         * @param {?} scrollingView
         * @return {?}
         */
        (scrollingView) => {
            if (Util.isUndefinedOrNull(scrollingView)) {
                return;
            }
            // Get the scrollTop or scrollLeft value of the first scrollingView that returns a value for its "scrollTop"
            // or "scrollLeft" property that is not undefined and unequal to 0
            /** @type {?} */
            const scrollPosition = pageScrollInstance.getScrollPropertyValue(scrollingView);
            if (!startScrollPositionFound && scrollPosition) {
                // We found a scrollingView that does not have scrollTop or scrollLeft 0
                // Return the scroll position value, as this will be our startScrollPosition
                pageScrollInstance.startScrollPosition = scrollPosition;
                startScrollPositionFound = true;
            }
        }));
        /** @type {?} */
        const pageScrollOffset = pageScrollInstance.getCurrentOffset();
        // Calculate the target position that the scroll animation should go to
        /** @type {?} */
        const scrollTargetPosition = pageScrollInstance.extractScrollTargetPosition();
        pageScrollInstance.targetScrollPosition = Math.round((pageScrollInstance.verticalScrolling
            ? scrollTargetPosition.top
            : scrollTargetPosition.left) - pageScrollOffset);
        // Calculate the distance we need to go in total
        pageScrollInstance.distanceToScroll =
            pageScrollInstance.targetScrollPosition - pageScrollInstance.startScrollPosition;
        if (isNaN(pageScrollInstance.distanceToScroll)) {
            // We weren't able to find the target position, maybe the element does not exist?
            if (isDevMode()) {
                // console.log('Scrolling not possible, as we can\'t find the specified target');
            }
            pageScrollInstance.fireEvent(false);
            return;
        }
        // We're at the final destination already
        // OR we need to scroll down but are already at the end
        // OR we need to scroll up but are at the top already
        /** @type {?} */
        const allReadyAtDestination = Math.abs(pageScrollInstance.distanceToScroll) < PageScrollConfig._minScrollDistance;
        // Check how long we need to scroll if a speed option is given
        // Default executionDuration is the specified duration
        pageScrollInstance.executionDuration = pageScrollInstance.duration;
        // Maybe we need to pay attention to the speed option?
        if (!Util.isUndefinedOrNull(pageScrollInstance.speed) &&
            Util.isUndefinedOrNull(pageScrollInstance.duration)) {
            // Speed option is set and no duration => calculate duration based on speed and scroll distance
            pageScrollInstance.executionDuration =
                (pageScrollInstance.distanceToScroll / pageScrollInstance.speed) * 1000;
        }
        // We should go there directly, as our "animation" would have one big step
        // only anyway and this way we save the interval stuff
        /** @type {?} */
        const tooShortInterval = pageScrollInstance.executionDuration <= PageScrollConfig._interval;
        if (allReadyAtDestination || tooShortInterval) {
            if (isDevMode()) {
                if (allReadyAtDestination) {
                    // console.log('Scrolling not possible, as we can\'t get any closer to the destination');
                }
                else {
                    // console.log('Scroll duration shorter that interval length, jumping to target');
                }
            }
            pageScrollInstance.setScrollPosition(pageScrollInstance.targetScrollPosition);
            pageScrollInstance.fireEvent(true);
            return;
        }
        // Register the interrupt listeners if we want an interruptible scroll animation
        if (pageScrollInstance.interruptible ||
            (Util.isUndefinedOrNull(pageScrollInstance.interruptible) &&
                PageScrollConfig.defaultInterruptible)) {
            pageScrollInstance.attachInterruptListeners(this.onInterrupted);
        }
        // Let's get started, get the start time...
        pageScrollInstance.startTime = new Date().getTime();
        // .. and calculate the end time (when we need to finish at last)
        pageScrollInstance.endTime =
            pageScrollInstance.startTime + pageScrollInstance.executionDuration;
        pageScrollInstance.timer = setInterval((/**
         * @param {?} _pageScrollInstance
         * @return {?}
         */
        (_pageScrollInstance) => {
            // Take the current time
            /** @type {?} */
            const currentTime = new Date().getTime();
            // Determine the new scroll position
            /** @type {?} */
            let newScrollPosition;
            /** @type {?} */
            let stopNow = false;
            if (_pageScrollInstance.endTime <= currentTime) {
                // We're over the time already, so go the targetScrollPosition (aka destination)
                newScrollPosition = _pageScrollInstance.targetScrollPosition;
                stopNow = true;
            }
            else {
                // Calculate the scroll position based on the current time using the easing function
                newScrollPosition = Math.round(_pageScrollInstance.easingLogic.ease(currentTime - _pageScrollInstance.startTime, _pageScrollInstance.startScrollPosition, _pageScrollInstance.distanceToScroll, _pageScrollInstance.executionDuration));
            }
            // Set the new scrollPosition to all scrollingViews elements
            if (!_pageScrollInstance.setScrollPosition(newScrollPosition)) {
                // Setting the new scrollTop/scrollLeft value failed for all ScrollingViews
                // early stop the scroll animation to save resources
                stopNow = true;
            }
            // At the end do the internal stop maintenance and fire the pageScrollFinish event
            // (otherwise the event might arrive at "too early")
            if (stopNow) {
                this.stopInternal(false, _pageScrollInstance);
            }
        }), PageScrollConfig._interval, pageScrollInstance);
        // Register the instance as running one
        this.runningInstances.push(pageScrollInstance);
    }
    /**
     * Stop all running scroll animations. Optionally limit to stop only the ones of specific namespace.
     *
     * @param {?=} namespace
     * @return {?}
     */
    stopAll(namespace) {
        if (this.runningInstances.length > 0) {
            /** @type {?} */
            let stoppedSome = false;
            for (let i = 0; i < this.runningInstances.length; ++i) {
                /** @type {?} */
                const pageScrollInstance = this.runningInstances[i];
                if (Util.isUndefinedOrNull(namespace) ||
                    namespace.length === 0 ||
                    pageScrollInstance.namespace === namespace) {
                    stoppedSome = true;
                    this.stopInternal(true, pageScrollInstance);
                    // Decrease the counter, as we removed an item from the array we iterate over
                    i--;
                }
            }
            return stoppedSome;
        }
        return false;
    }
    /**
     * @param {?} pageScrollInstance
     * @return {?}
     */
    stop(pageScrollInstance) {
        return this.stopInternal(true, pageScrollInstance);
    }
}
PageScrollService.ɵfac = function PageScrollService_Factory(t) { return new (t || PageScrollService)(); };
PageScrollService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: PageScrollService, factory: PageScrollService.ɵfac });
PageScrollService.instanceCounter = 0;
/** @nocollapse */
PageScrollService.ctorParameters = () => [];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(PageScrollService, [{
        type: Injectable
    }], function () { return []; }, null); })();
if (false) {
    /**
     * @type {?}
     * @private
     */
    PageScrollService.instanceCounter;
    /**
     * @type {?}
     * @private
     */
    PageScrollService.prototype.runningInstances;
    /**
     * @type {?}
     * @private
     */
    PageScrollService.prototype.onInterrupted;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRiLXBhZ2Utc2Nyb2xsLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIm5nLXVpa2l0LXByby1zdGFuZGFyZC9saWIvcHJvL3Ntb290aHNjcm9sbC9tZGItcGFnZS1zY3JvbGwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFNUQsT0FBTyxFQUFFLHFCQUFxQixJQUFJLElBQUksRUFBRSxNQUFNLGdDQUFnQyxDQUFDOztBQUcvRSxNQUFNLE9BQU8saUJBQWlCO0FBQzlCLElBK1BFO0FBQ0YsUUE5UFUscUJBQWdCLEdBQXlCLEVBQUUsQ0FBQztBQUN0RCxRQUNVLGtCQUFhLEdBQXNCO0FBQzdDLFlBQUksTUFBTTtBQUFPO0FBQWdDO0FBQ2pDO0FBQTJCO0FBQy9CLFlBRkEsQ0FBQyxLQUFZLEVBQUUsa0JBQXNDLEVBQVEsRUFBRTtBQUMzRSxnQkFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsYUFBYSxFQUFFO0FBQzdDLG9CQUFRLG9EQUFvRDtBQUM1RCxvQkFBUSxPQUFPO0FBQ2YsaUJBQU87QUFDUDtBQUdFLG9CQUZRLFVBQVUsR0FBRyxJQUFJO0FBQzNCLGdCQUNNLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxPQUFPLEVBQUU7QUFDbEMsb0JBQVEsbUZBQW1GO0FBQzNGLG9CQUFRLHdDQUF3QztBQUNoRCxvQkFBUSxJQUFJLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxtQkFBZSxLQUFLLEVBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO0FBQzVGLHdCQUFVLDBEQUEwRDtBQUNwRSx3QkFBVSxVQUFVLEdBQUcsS0FBSyxDQUFDO0FBQzdCLHFCQUFTO0FBQ1QsaUJBQU87QUFBQyxxQkFBSyxJQUFJLEtBQUssQ0FB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LEFBQUEsQUFnUUEsQUE3UEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBMk5BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQWhPQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQVFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFJQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFLQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBSUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFNQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUE3UEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUZBLEFBQUEsQUFFQSxBQUFBLEFBRUEsQUFBQSxBQUVBLEFBaUNBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgaXNEZXZNb2RlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBhZ2VTY3JvbGxDb25maWcgfSBmcm9tICcuL21kYi1wYWdlLXNjcm9sbC5jb25maWcnO1xuaW1wb3J0IHsgUGFnZVNjcm9sbEluc3RhbmNlLCBJbnRlcnJ1cHRSZXBvcnRlciB9IGZyb20gJy4vbWRiLXBhZ2Utc2Nyb2xsLmluc3RhbmNlJztcbmltcG9ydCB7IFBhZ2VTY3JvbGxVdGlsU2VydmljZSBhcyBVdGlsIH0gZnJvbSAnLi9tZGItcGFnZS1zY3JvbGwtdXRpbC5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBhZ2VTY3JvbGxTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2VDb3VudGVyID0gMDtcblxuICBwcml2YXRlIHJ1bm5pbmdJbnN0YW5jZXM6IFBhZ2VTY3JvbGxJbnN0YW5jZVtdID0gW107XG5cbiAgcHJpdmF0ZSBvbkludGVycnVwdGVkOiBJbnRlcnJ1cHRSZXBvcnRlciA9IHtcbiAgICByZXBvcnQ6IChldmVudDogRXZlbnQsIHBhZ2VTY3JvbGxJbnN0YW5jZTogUGFnZVNjcm9sbEluc3RhbmNlKTogdm9pZCA9PiB7XG4gICAgICBpZiAoIXBhZ2VTY3JvbGxJbnN0YW5jZS5pbnRlcnJ1cHRpYmxlKSB7XG4gICAgICAgIC8vIE5vbi1pbnRlcnJ1cHRpYmxlIGFueXdheSwgc28gZG8gbm90IHN0b3AgYW55dGhpbmdcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQgc2hvdWxkU3RvcCA9IHRydWU7XG5cbiAgICAgIGlmIChldmVudC50eXBlID09PSAna2V5dXAnKSB7XG4gICAgICAgIC8vIE9ubHkgc3RvcCBpZiBzcGVjaWZpYyBrZXlzIGhhdmUgYmVlbiBwcmVzc2VkLCBmb3IgYWxsIG90aGVycyBkb24ndCBzdG9wIGFueXRoaW5nXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogZGVwcmVjYXRpb25cbiAgICAgICAgaWYgKFBhZ2VTY3JvbGxDb25maWcuX2ludGVycnVwdEtleXMuaW5kZXhPZigoPEtleWJvYXJkRXZlbnQ+ZXZlbnQpLmtleUNvZGUpID09PSAtMSkge1xuICAgICAgICAgIC8vIFRoZSBwcmVzc2VkIGtleSBpcyBub3QgaW4gdGhlIGxpc3Qgb2YgaW50ZXJydXB0aW5nIGtleXNcbiAgICAgICAgICBzaG91bGRTdG9wID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNlZG93bicpIHtcbiAgICAgICAgLy8gRm9yIG1vdXNlZG93biBldmVudHMgd2Ugb25seSBzdG9wIHRoZSBzY3JvbGwgYW5pbWF0aW9uIG9mIHRoZSBtb3VzZSBoYXNcbiAgICAgICAgLy8gYmVlbiBjbGlja2VkIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lclxuICAgICAgICBpZiAoXG4gICAgICAgICAgIXBhZ2VTY3JvbGxJbnN0YW5jZS5zY3JvbGxpbmdWaWV3cy5zb21lKHNjcm9sbGluZ1ZpZXcgPT5cbiAgICAgICAgICAgIHNjcm9sbGluZ1ZpZXcuY29udGFpbnMoZXZlbnQudGFyZ2V0KVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gTW91c2UgY2xpY2tlZCBhbiBlbGVtZW50IHdoaWNoIGlzIG5vdCBpbnNpZGUgYW55IG9mIHRoZSB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lcnNcbiAgICAgICAgICBzaG91bGRTdG9wID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHNob3VsZFN0b3ApIHtcbiAgICAgICAgdGhpcy5zdG9wQWxsKHBhZ2VTY3JvbGxJbnN0YW5jZS5uYW1lc3BhY2UpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgcHJpdmF0ZSBzdG9wSW50ZXJuYWwoaW50ZXJydXB0ZWQ6IGJvb2xlYW4sIHBhZ2VTY3JvbGxJbnN0YW5jZTogUGFnZVNjcm9sbEluc3RhbmNlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgaW5kZXg6IG51bWJlciA9IHRoaXMucnVubmluZ0luc3RhbmNlcy5pbmRleE9mKHBhZ2VTY3JvbGxJbnN0YW5jZSk7XG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHRoaXMucnVubmluZ0luc3RhbmNlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cblxuICAgIGlmIChwYWdlU2Nyb2xsSW5zdGFuY2UuaW50ZXJydXB0TGlzdGVuZXJzQXR0YWNoZWQpIHtcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5kZXRhY2hJbnRlcnJ1cHRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBpZiAocGFnZVNjcm9sbEluc3RhbmNlLnRpbWVyKSB7XG4gICAgICAvLyBDbGVhci9TdG9wIHRoZSB0aW1lclxuICAgICAgY2xlYXJJbnRlcnZhbChwYWdlU2Nyb2xsSW5zdGFuY2UudGltZXIpO1xuICAgICAgLy8gQ2xlYXIgdGhlIHJlZmVyZW5jZSB0byB0aGlzIHRpbWVyXG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UudGltZXIgPSB1bmRlZmluZWQ7XG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZmlyZUV2ZW50KCFpbnRlcnJ1cHRlZCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGEgc2Nyb2xsIGFuaW1hdGlvbi4gQWxsIHByb3BlcnRpZXMgb2YgdGhlIGFuaW1hdGlvbiBhcmUgc3RvcmVkIGluIHRoZSBnaXZlbiB7QGxpbmsgUGFnZVNjcm9sbEluc3RhbmNlfSBvYmplY3QuXG4gICAqXG4gICAqIFRoaXMgaXMgdGhlIGNvcmUgZnVuY3Rpb25hbGl0eSBvZiB0aGUgd2hvbGUgbGlicmFyeS5cbiAgICpcbiAgICovXG4gIHB1YmxpYyBzdGFydChwYWdlU2Nyb2xsSW5zdGFuY2U6IFBhZ2VTY3JvbGxJbnN0YW5jZSk6IHZvaWQge1xuICAgIC8vIFN0b3AgYWxsIHBvc3NpYmx5IHJ1bm5pbmcgc2Nyb2xsIGFuaW1hdGlvbnMgaW4gdGhlIHNhbWUgbmFtZXNwYWNlXG4gICAgdGhpcy5zdG9wQWxsKHBhZ2VTY3JvbGxJbnN0YW5jZS5uYW1lc3BhY2UpO1xuXG4gICAgaWYgKFxuICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLnNjcm9sbGluZ1ZpZXdzID09PSBudWxsIHx8XG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2Uuc2Nyb2xsaW5nVmlld3MubGVuZ3RoID09PSAwXG4gICAgKSB7XG4gICAgICAvLyBObyBzY3JvbGxpbmdWaWV3cyBzcGVjaWZpZWQsIHRodXMgd2UgY2FuJ3QgYW5pbWF0ZSBhbnl0aGluZ1xuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnTm8gc2Nyb2xsaW5nVmlld3Mgc3BlY2lmaWVkLCB0aGlzIG5nMi1wYWdlLXNjcm9sbCBkb2VzIG5vdCBrbm93IHdoaWNoIERPTSBlbGVtZW50cyB0byBzY3JvbGwnXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHN0YXJ0U2Nyb2xsUG9zaXRpb25Gb3VuZCA9IGZhbHNlO1xuICAgIC8vIFJlc2V0IHN0YXJ0IHNjcm9sbCBwb3NpdGlvbiB0byAwLiBJZiBhbnkgb2YgdGhlIHNjcm9sbGluZ1ZpZXdzIGhhcyBhIGRpZmZlcmVudCBvbmUsIGl0IHdpbGwgYmUgZXh0cmFjdGVkIG5leHRcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2Uuc3RhcnRTY3JvbGxQb3NpdGlvbiA9IDA7XG5cbiAgICAvLyBHZXQgdGhlIHN0YXJ0IHNjcm9sbCBwb3NpdGlvbiBmcm9tIHRoZSBzY3JvbGxpbmdWaWV3cyAoZS5nLiBpZiB0aGUgdXNlciBhbHJlYWR5IHNjcm9sbGVkIGRvd24gdGhlIGNvbnRlbnQpXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLnNjcm9sbGluZ1ZpZXdzLmZvckVhY2goKHNjcm9sbGluZ1ZpZXc6IGFueSkgPT4ge1xuICAgICAgaWYgKFV0aWwuaXNVbmRlZmluZWRPck51bGwoc2Nyb2xsaW5nVmlldykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gR2V0IHRoZSBzY3JvbGxUb3Agb3Igc2Nyb2xsTGVmdCB2YWx1ZSBvZiB0aGUgZmlyc3Qgc2Nyb2xsaW5nVmlldyB0aGF0IHJldHVybnMgYSB2YWx1ZSBmb3IgaXRzIFwic2Nyb2xsVG9wXCJcbiAgICAgIC8vIG9yIFwic2Nyb2xsTGVmdFwiIHByb3BlcnR5IHRoYXQgaXMgbm90IHVuZGVmaW5lZCBhbmQgdW5lcXVhbCB0byAwXG5cbiAgICAgIGNvbnN0IHNjcm9sbFBvc2l0aW9uID0gcGFnZVNjcm9sbEluc3RhbmNlLmdldFNjcm9sbFByb3BlcnR5VmFsdWUoc2Nyb2xsaW5nVmlldyk7XG4gICAgICBpZiAoIXN0YXJ0U2Nyb2xsUG9zaXRpb25Gb3VuZCAmJiBzY3JvbGxQb3NpdGlvbikge1xuICAgICAgICAvLyBXZSBmb3VuZCBhIHNjcm9sbGluZ1ZpZXcgdGhhdCBkb2VzIG5vdCBoYXZlIHNjcm9sbFRvcCBvciBzY3JvbGxMZWZ0IDBcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHNjcm9sbCBwb3NpdGlvbiB2YWx1ZSwgYXMgdGhpcyB3aWxsIGJlIG91ciBzdGFydFNjcm9sbFBvc2l0aW9uXG4gICAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFNjcm9sbFBvc2l0aW9uID0gc2Nyb2xsUG9zaXRpb247XG4gICAgICAgIHN0YXJ0U2Nyb2xsUG9zaXRpb25Gb3VuZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBwYWdlU2Nyb2xsT2Zmc2V0ID0gcGFnZVNjcm9sbEluc3RhbmNlLmdldEN1cnJlbnRPZmZzZXQoKTtcblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgdGFyZ2V0IHBvc2l0aW9uIHRoYXQgdGhlIHNjcm9sbCBhbmltYXRpb24gc2hvdWxkIGdvIHRvXG5cbiAgICBjb25zdCBzY3JvbGxUYXJnZXRQb3NpdGlvbiA9IHBhZ2VTY3JvbGxJbnN0YW5jZS5leHRyYWN0U2Nyb2xsVGFyZ2V0UG9zaXRpb24oKTtcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2UudGFyZ2V0U2Nyb2xsUG9zaXRpb24gPSBNYXRoLnJvdW5kKFxuICAgICAgKHBhZ2VTY3JvbGxJbnN0YW5jZS52ZXJ0aWNhbFNjcm9sbGluZ1xuICAgICAgICA/IHNjcm9sbFRhcmdldFBvc2l0aW9uLnRvcFxuICAgICAgICA6IHNjcm9sbFRhcmdldFBvc2l0aW9uLmxlZnQpIC0gcGFnZVNjcm9sbE9mZnNldFxuICAgICk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdGhlIGRpc3RhbmNlIHdlIG5lZWQgdG8gZ28gaW4gdG90YWxcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZGlzdGFuY2VUb1Njcm9sbCA9XG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UudGFyZ2V0U2Nyb2xsUG9zaXRpb24gLSBwYWdlU2Nyb2xsSW5zdGFuY2Uuc3RhcnRTY3JvbGxQb3NpdGlvbjtcblxuICAgIGlmIChpc05hTihwYWdlU2Nyb2xsSW5zdGFuY2UuZGlzdGFuY2VUb1Njcm9sbCkpIHtcbiAgICAgIC8vIFdlIHdlcmVuJ3QgYWJsZSB0byBmaW5kIHRoZSB0YXJnZXQgcG9zaXRpb24sIG1heWJlIHRoZSBlbGVtZW50IGRvZXMgbm90IGV4aXN0P1xuXG4gICAgICBpZiAoaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ1Njcm9sbGluZyBub3QgcG9zc2libGUsIGFzIHdlIGNhblxcJ3QgZmluZCB0aGUgc3BlY2lmaWVkIHRhcmdldCcpO1xuICAgICAgfVxuICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLmZpcmVFdmVudChmYWxzZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gV2UncmUgYXQgdGhlIGZpbmFsIGRlc3RpbmF0aW9uIGFscmVhZHlcbiAgICAvLyBPUiB3ZSBuZWVkIHRvIHNjcm9sbCBkb3duIGJ1dCBhcmUgYWxyZWFkeSBhdCB0aGUgZW5kXG4gICAgLy8gT1Igd2UgbmVlZCB0byBzY3JvbGwgdXAgYnV0IGFyZSBhdCB0aGUgdG9wIGFscmVhZHlcbiAgICBjb25zdCBhbGxSZWFkeUF0RGVzdGluYXRpb24gPVxuICAgICAgTWF0aC5hYnMocGFnZVNjcm9sbEluc3RhbmNlLmRpc3RhbmNlVG9TY3JvbGwpIDwgUGFnZVNjcm9sbENvbmZpZy5fbWluU2Nyb2xsRGlzdGFuY2U7XG5cbiAgICAvLyBDaGVjayBob3cgbG9uZyB3ZSBuZWVkIHRvIHNjcm9sbCBpZiBhIHNwZWVkIG9wdGlvbiBpcyBnaXZlblxuICAgIC8vIERlZmF1bHQgZXhlY3V0aW9uRHVyYXRpb24gaXMgdGhlIHNwZWNpZmllZCBkdXJhdGlvblxuICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5leGVjdXRpb25EdXJhdGlvbiA9IHBhZ2VTY3JvbGxJbnN0YW5jZS5kdXJhdGlvbjtcbiAgICAvLyBNYXliZSB3ZSBuZWVkIHRvIHBheSBhdHRlbnRpb24gdG8gdGhlIHNwZWVkIG9wdGlvbj9cbiAgICBpZiAoXG4gICAgICAhVXRpbC5pc1VuZGVmaW5lZE9yTnVsbChwYWdlU2Nyb2xsSW5zdGFuY2Uuc3BlZWQpICYmXG4gICAgICBVdGlsLmlzVW5kZWZpbmVkT3JOdWxsKHBhZ2VTY3JvbGxJbnN0YW5jZS5kdXJhdGlvbilcbiAgICApIHtcbiAgICAgIC8vIFNwZWVkIG9wdGlvbiBpcyBzZXQgYW5kIG5vIGR1cmF0aW9uID0+IGNhbGN1bGF0ZSBkdXJhdGlvbiBiYXNlZCBvbiBzcGVlZCBhbmQgc2Nyb2xsIGRpc3RhbmNlXG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZXhlY3V0aW9uRHVyYXRpb24gPVxuICAgICAgICAocGFnZVNjcm9sbEluc3RhbmNlLmRpc3RhbmNlVG9TY3JvbGwgLyBwYWdlU2Nyb2xsSW5zdGFuY2Uuc3BlZWQpICogMTAwMDtcbiAgICB9XG5cbiAgICAvLyBXZSBzaG91bGQgZ28gdGhlcmUgZGlyZWN0bHksIGFzIG91ciBcImFuaW1hdGlvblwiIHdvdWxkIGhhdmUgb25lIGJpZyBzdGVwXG4gICAgLy8gb25seSBhbnl3YXkgYW5kIHRoaXMgd2F5IHdlIHNhdmUgdGhlIGludGVydmFsIHN0dWZmXG4gICAgY29uc3QgdG9vU2hvcnRJbnRlcnZhbCA9IHBhZ2VTY3JvbGxJbnN0YW5jZS5leGVjdXRpb25EdXJhdGlvbiA8PSBQYWdlU2Nyb2xsQ29uZmlnLl9pbnRlcnZhbDtcblxuICAgIGlmIChhbGxSZWFkeUF0RGVzdGluYXRpb24gfHwgdG9vU2hvcnRJbnRlcnZhbCkge1xuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGlmIChhbGxSZWFkeUF0RGVzdGluYXRpb24pIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnU2Nyb2xsaW5nIG5vdCBwb3NzaWJsZSwgYXMgd2UgY2FuXFwndCBnZXQgYW55IGNsb3NlciB0byB0aGUgZGVzdGluYXRpb24nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnU2Nyb2xsIGR1cmF0aW9uIHNob3J0ZXIgdGhhdCBpbnRlcnZhbCBsZW5ndGgsIGp1bXBpbmcgdG8gdGFyZ2V0Jyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5zZXRTY3JvbGxQb3NpdGlvbihwYWdlU2Nyb2xsSW5zdGFuY2UudGFyZ2V0U2Nyb2xsUG9zaXRpb24pO1xuICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLmZpcmVFdmVudCh0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBSZWdpc3RlciB0aGUgaW50ZXJydXB0IGxpc3RlbmVycyBpZiB3ZSB3YW50IGFuIGludGVycnVwdGlibGUgc2Nyb2xsIGFuaW1hdGlvblxuICAgIGlmIChcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5pbnRlcnJ1cHRpYmxlIHx8XG4gICAgICAoVXRpbC5pc1VuZGVmaW5lZE9yTnVsbChwYWdlU2Nyb2xsSW5zdGFuY2UuaW50ZXJydXB0aWJsZSkgJiZcbiAgICAgICAgUGFnZVNjcm9sbENvbmZpZy5kZWZhdWx0SW50ZXJydXB0aWJsZSlcbiAgICApIHtcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5hdHRhY2hJbnRlcnJ1cHRMaXN0ZW5lcnModGhpcy5vbkludGVycnVwdGVkKTtcbiAgICB9XG5cbiAgICAvLyBMZXQncyBnZXQgc3RhcnRlZCwgZ2V0IHRoZSBzdGFydCB0aW1lLi4uXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIC8vIC4uIGFuZCBjYWxjdWxhdGUgdGhlIGVuZCB0aW1lICh3aGVuIHdlIG5lZWQgdG8gZmluaXNoIGF0IGxhc3QpXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLmVuZFRpbWUgPVxuICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLnN0YXJ0VGltZSArIHBhZ2VTY3JvbGxJbnN0YW5jZS5leGVjdXRpb25EdXJhdGlvbjtcblxuICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS50aW1lciA9IHNldEludGVydmFsKFxuICAgICAgKF9wYWdlU2Nyb2xsSW5zdGFuY2U6IFBhZ2VTY3JvbGxJbnN0YW5jZSkgPT4ge1xuICAgICAgICAvLyBUYWtlIHRoZSBjdXJyZW50IHRpbWVcbiAgICAgICAgY29uc3QgY3VycmVudFRpbWU6IG51bWJlciA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gICAgICAgIC8vIERldGVybWluZSB0aGUgbmV3IHNjcm9sbCBwb3NpdGlvblxuICAgICAgICBsZXQgbmV3U2Nyb2xsUG9zaXRpb246IG51bWJlcjtcbiAgICAgICAgbGV0IHN0b3BOb3cgPSBmYWxzZTtcbiAgICAgICAgaWYgKF9wYWdlU2Nyb2xsSW5zdGFuY2UuZW5kVGltZSA8PSBjdXJyZW50VGltZSkge1xuICAgICAgICAgIC8vIFdlJ3JlIG92ZXIgdGhlIHRpbWUgYWxyZWFkeSwgc28gZ28gdGhlIHRhcmdldFNjcm9sbFBvc2l0aW9uIChha2EgZGVzdGluYXRpb24pXG4gICAgICAgICAgbmV3U2Nyb2xsUG9zaXRpb24gPSBfcGFnZVNjcm9sbEluc3RhbmNlLnRhcmdldFNjcm9sbFBvc2l0aW9uO1xuICAgICAgICAgIHN0b3BOb3cgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgc2Nyb2xsIHBvc2l0aW9uIGJhc2VkIG9uIHRoZSBjdXJyZW50IHRpbWUgdXNpbmcgdGhlIGVhc2luZyBmdW5jdGlvblxuICAgICAgICAgIG5ld1Njcm9sbFBvc2l0aW9uID0gTWF0aC5yb3VuZChcbiAgICAgICAgICAgIF9wYWdlU2Nyb2xsSW5zdGFuY2UuZWFzaW5nTG9naWMuZWFzZShcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgLSBfcGFnZVNjcm9sbEluc3RhbmNlLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgX3BhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFNjcm9sbFBvc2l0aW9uLFxuICAgICAgICAgICAgICBfcGFnZVNjcm9sbEluc3RhbmNlLmRpc3RhbmNlVG9TY3JvbGwsXG4gICAgICAgICAgICAgIF9wYWdlU2Nyb2xsSW5zdGFuY2UuZXhlY3V0aW9uRHVyYXRpb25cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNldCB0aGUgbmV3IHNjcm9sbFBvc2l0aW9uIHRvIGFsbCBzY3JvbGxpbmdWaWV3cyBlbGVtZW50c1xuICAgICAgICBpZiAoIV9wYWdlU2Nyb2xsSW5zdGFuY2Uuc2V0U2Nyb2xsUG9zaXRpb24obmV3U2Nyb2xsUG9zaXRpb24pKSB7XG4gICAgICAgICAgLy8gU2V0dGluZyB0aGUgbmV3IHNjcm9sbFRvcC9zY3JvbGxMZWZ0IHZhbHVlIGZhaWxlZCBmb3IgYWxsIFNjcm9sbGluZ1ZpZXdzXG4gICAgICAgICAgLy8gZWFybHkgc3RvcCB0aGUgc2Nyb2xsIGFuaW1hdGlvbiB0byBzYXZlIHJlc291cmNlc1xuICAgICAgICAgIHN0b3BOb3cgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQXQgdGhlIGVuZCBkbyB0aGUgaW50ZXJuYWwgc3RvcCBtYWludGVuYW5jZSBhbmQgZmlyZSB0aGUgcGFnZVNjcm9sbEZpbmlzaCBldmVudFxuICAgICAgICAvLyAob3RoZXJ3aXNlIHRoZSBldmVudCBtaWdodCBhcnJpdmUgYXQgXCJ0b28gZWFybHlcIilcbiAgICAgICAgaWYgKHN0b3BOb3cpIHtcbiAgICAgICAgICB0aGlzLnN0b3BJbnRlcm5hbChmYWxzZSwgX3BhZ2VTY3JvbGxJbnN0YW5jZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBQYWdlU2Nyb2xsQ29uZmlnLl9pbnRlcnZhbCxcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZVxuICAgICk7XG5cbiAgICAvLyBSZWdpc3RlciB0aGUgaW5zdGFuY2UgYXMgcnVubmluZyBvbmVcbiAgICB0aGlzLnJ1bm5pbmdJbnN0YW5jZXMucHVzaChwYWdlU2Nyb2xsSW5zdGFuY2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgYWxsIHJ1bm5pbmcgc2Nyb2xsIGFuaW1hdGlvbnMuIE9wdGlvbmFsbHkgbGltaXQgdG8gc3RvcCBvbmx5IHRoZSBvbmVzIG9mIHNwZWNpZmljIG5hbWVzcGFjZS5cbiAgICpcbiAgICovXG4gIHB1YmxpYyBzdG9wQWxsKG5hbWVzcGFjZT86IHN0cmluZyB8IGFueSk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLnJ1bm5pbmdJbnN0YW5jZXMubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IHN0b3BwZWRTb21lID0gZmFsc2U7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ydW5uaW5nSW5zdGFuY2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGNvbnN0IHBhZ2VTY3JvbGxJbnN0YW5jZSA9IHRoaXMucnVubmluZ0luc3RhbmNlc1tpXTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIFV0aWwuaXNVbmRlZmluZWRPck51bGwobmFtZXNwYWNlKSB8fFxuICAgICAgICAgIG5hbWVzcGFjZS5sZW5ndGggPT09IDAgfHxcbiAgICAgICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UubmFtZXNwYWNlID09PSBuYW1lc3BhY2VcbiAgICAgICAgKSB7XG4gICAgICAgICAgc3RvcHBlZFNvbWUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuc3RvcEludGVybmFsKHRydWUsIHBhZ2VTY3JvbGxJbnN0YW5jZSk7XG4gICAgICAgICAgLy8gRGVjcmVhc2UgdGhlIGNvdW50ZXIsIGFzIHdlIHJlbW92ZWQgYW4gaXRlbSBmcm9tIHRoZSBhcnJheSB3ZSBpdGVyYXRlIG92ZXJcbiAgICAgICAgICBpLS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBzdG9wcGVkU29tZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHVibGljIHN0b3AocGFnZVNjcm9sbEluc3RhbmNlOiBQYWdlU2Nyb2xsSW5zdGFuY2UpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdG9wSW50ZXJuYWwodHJ1ZSwgcGFnZVNjcm9sbEluc3RhbmNlKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGlmIChQYWdlU2Nyb2xsU2VydmljZS5pbnN0YW5jZUNvdW50ZXIgPiAwICYmIGlzRGV2TW9kZSgpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdBbiBpbnN0YW5jZSBvZiBQYWdlU2Nyb2xsU2VydmljZSBhbHJlYWR5IGV4aXN0cywgdXN1YWxseSAnICtcbiAgICAgICAgICAnaW5jbHVkaW5nIG9uZSBwcm92aWRlciBzaG91bGQgYmUgZW5vdWdoLCBzbyBkb3VibGUgY2hlY2suJ1xuICAgICAgKTtcbiAgICB9XG4gICAgUGFnZVNjcm9sbFNlcnZpY2UuaW5zdGFuY2VDb3VudGVyKys7XG4gIH1cbn1cbiJdfQ==